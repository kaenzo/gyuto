---
- when: ansible_distribution == 'MacOSX'  # ONLY run on MacOS
  block:
    - name: Check Motrix file
      stat: path=/Applications/Motrix.app
      register: motrix_check

    - name: debug
      debug:
        var: motrix_check
        #msg: "motrix exists: {{motrix_check}}"

    - name: Ensure Motrix not installed
      fail:
        msg: "Delete Motrix in /Applications and run again"
      when: motrix_check.stat.exists

    - name: Check Motrix DMG file
      stat: path="~/Downloads/Motrix-1.6.11.dmg"
      register: dmg_check

    - name: Ensure Motrix DMG file exists
      fail:
        msg: "Download Motrix to ~/Downloads directory and run again"
      when: not dmg_check.stat.exists

    - name: Install Motrix from local DMG file
      dmg:
        name: "Motrix"
        path: "~/Downloads/Motrix-1.6.11.dmg"

    - name: Check Motrix file
      stat: path=/Applications/Motrix.app
      register: motrix_check

    - name: Verify Motrix installed
      assert:
        that: motrix_check.stat.exists 

    - name: Remove Motrix
      file:
        path: /Applications/Motrix.app
        state: absent

    - name: Install Motrix from remote url
      dmg:
        name: Motrix
        url: https://dl.moapp.me/https://github.com/agalwood/Motrix/releases/download/v1.6.11/Motrix-1.6.11.dmg

    - name: Check Motrix file
      stat: path=/Applications/Motrix.app
      register: motrix_check

    - name: Verify Motrix installed
      assert:
        that: motrix_check.stat.exists 
